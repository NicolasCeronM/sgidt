{% extends "base_public.html" %}
{% load static %}

{% block title %}Iniciar Sesión - SGIDT{% endblock %}

{% block css %}
<link rel="stylesheet" href="{% static 'usuarios/css/login.css' %}">
{% endblock %}

{% block content %}
<div class="login-container">
  <h1 class="login-title">Accede a tu cuenta</h1>
  <p class="login-subtitle">Gestión inteligente de documentos tributarios</p>

  {% if form.non_field_errors %}
  <div class="error-message" role="alert" style="display:block">
    {% for err in form.non_field_errors %}{{ err }}{% if not forloop.last %}<br>{% endif %}{% endfor %}
  </div>
  {% endif %}

  <form method="post" id="loginForm" novalidate>
    {% csrf_token %}
    {% if next %}<input type="hidden" name="next" value="{{ next }}">{% endif %}

    <!-- Usuario -->
    <div class="form-group">
      <label for="{{ form.username.id_for_label }}" class="form-label">Correo o RUT</label>
      <input
        type="text"
        id="{{ form.username.auto_id }}"
        name="{{ form.username.html_name }}"
        class="form-input"
        required
        autocomplete="username"
        value="{{ form.username.value|default_if_none:'' }}"
        placeholder="correo@dominio.cl o 12.345.678-9"
        {% if form.username.errors %}aria-invalid="true"{% endif %}>
      {% if form.username.errors %}
      <div class="field-error">
        {% for err in form.username.errors %}{{ err }}{% if not forloop.last %}<br>{% endif %}{% endfor %}
      </div>
      {% endif %}
    </div>

    <!-- Contraseña -->
    <div class="form-group password-group">
      <label for="{{ form.password.id_for_label }}" class="form-label">Contraseña</label>
      <div class="password-wrapper">
        <input
          type="password"
          id="{{ form.password.auto_id }}"
          name="{{ form.password.html_name }}"
          class="form-input"
          required
          autocomplete="current-password"
          placeholder="••••••••"
          {% if form.password.errors %}aria-invalid="true"{% endif %}>
        <button type="button" class="toggle-password" aria-label="Mostrar u ocultar contraseña">
          <i class="far fa-eye"></i>
        </button>
      </div>
      {% if form.password.errors %}
      <div class="field-error">
        {% for err in form.password.errors %}{{ err }}{% if not forloop.last %}<br>{% endif %}{% endfor %}
      </div>
      {% endif %}
    </div>

    <div class="form-checkbox">
      <input type="checkbox" id="remember" name="remember">
      <label for="remember">Recordarme</label>
      <a class="link-forgot" href="#">¿Olvidaste tu contraseña?</a>
    </div>

    <button type="submit" class="btn-login">
      Iniciar Sesión
    </button>
  </form>

  <div class="divider"><span>o</span></div>

  <p class="register-link">
    ¿No tienes cuenta?

  </p>
  <p class="register-link" style="margin-top:.5rem;">
    ¿Eres empresa?
    <a href="{% url 'empresas:registro_pyme' %}">Registrar empresa / PYME</a>
  </p>
</div>
{% endblock %}

{% block js %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>
<script>
  // Mostrar/ocultar contraseña
  (function () {
    const toggle = document.querySelector('.toggle-password');
    const input = document.getElementById('{{ form.password.auto_id }}');
    if (toggle && input) {
      toggle.addEventListener('click', () => {
        const isPwd = input.type === 'password';
        input.type = isPwd ? 'text' : 'password';
        toggle.innerHTML = isPwd
          ? '<i class="far fa-eye-slash"></i>'
          : '<i class="far fa-eye"></i>';
      });
    }
  })();
</script>
{% endblock %}
