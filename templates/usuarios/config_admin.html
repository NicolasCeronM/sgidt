{% extends "base_app.html" %}
{% load static %}
{% block title %}Configuración de Administrador{% endblock %}

{% block content %}

<!-- CSS específico de esta vista -->
<link rel="stylesheet" href="{% static 'usuarios/css/config_admin.css' %}?v=2">

<div class="admincfg container py-4">

  <!-- Encabezado -->
  <header class="admincfg__header">
    <div class="admincfg__titleblock">
      <h2 class="admincfg__title">Configuración de Administrador</h2>
      <p class="admincfg__subtitle">
        Empresa activa:
        <span class="admincfg__badge">
          {% if empresa.logo %}
          <img src="{{ empresa.logo.url }}" alt="Logo" class="admincfg__badge-logo">
          {% endif %}
          <strong>{{ empresa.razon_social }}</strong> ({{ empresa.rut }})
        </span>
      </p>
    </div>
  </header>

  <div class="row admincfg__grid">

    <!-- ====== Bloque Empresa ====== -->
    <div class="col-12 col-lg-6">
      <div class="admincfg__block">
        <section class="card admincfg__card">
          <div class="card-header admincfg__card-header">
            <div class="admincfg__card-head">
              <i class="fa-regular fa-building admincfg__card-icon" aria-hidden="true"></i>
              <h5 class="mb-0">Datos de la Empresa</h5>
            </div>
          </div>

          <div class="card-body admincfg__card-body">
            <form method="post" enctype="multipart/form-data" novalidate>
              {% csrf_token %}
              {{ f_empresa.non_field_errors }}

              <!-- Logo -->
              <div class="mb-3">
                <label class="form-label">Logo</label>

                {% if empresa.logo %}
                <div class="admincfg__preview">
                  <img src="{{ empresa.logo.url }}" alt="Logo actual" class="admincfg__preview-img">
                  <span class="admincfg__preview-note">Logo actual</span>
                </div>
                {% endif %}

                <div class="admincfg__file">
                  {{ f_empresa.logo }}
                </div>
                <div class="form-text">Formatos: JPG/PNG. Tamaño recomendado ≤ 1MB.</div>
              </div>

              <!-- Campos restantes de empresa -->
              {% for field in f_empresa %}
              {% if field.name != "logo" %}
              <div class="mb-3">
                <label class="form-label">{{ field.label }}</label>
                {{ field }}
                {% if field.help_text %}
                <div class="form-text">{{ field.help_text }}</div>
                {% endif %}
                {% for e in field.errors %}
                <div class="text-danger small">{{ e }}</div>
                {% endfor %}
              </div>
              {% endif %}
              {% endfor %}

              <div class="admincfg__actions">
                <button type="submit" name="guardar_empresa" class="btn btn-primary admincfg__btn">
                  <i class="fa-regular fa-floppy-disk" aria-hidden="true"></i>
                  Guardar Empresa
                </button>
              </div>
            </form>
          </div>
        </section>
      </div>
    </div>

    <!-- ====== Bloque Usuario ====== -->
    <div class="col-12 col-lg-6">
      <div class="admincfg__block">
        <section class="card admincfg__card">
          <div class="card-header admincfg__card-header">
            <div class="admincfg__card-head">
              <i class="fa-regular fa-user admincfg__card-icon" aria-hidden="true"></i>
              <h5 class="mb-0">Perfil del Administrador</h5>
            </div>
          </div>

          <div class="card-body admincfg__card-body">
            <form method="post" enctype="multipart/form-data" novalidate>
              {% csrf_token %}
              {{ f_usuario.non_field_errors }}

              <!-- Foto -->
              <div class="mb-3">
                <label class="form-label">Foto de perfil</label>

                {% if request.user.foto %}
                <div class="admincfg__preview admincfg__preview--circle">
                  <img src="{{ request.user.foto.url }}" alt="Avatar actual" class="admincfg__preview-img">
                  <span class="admincfg__preview-note">Foto actual</span>
                </div>
                {% endif %}

                <div class="admincfg__file">
                  {{ f_usuario.foto }}
                </div>
                <div class="form-text">Formatos: JPG/PNG. Tamaño recomendado ≤ 1MB.</div>
              </div>

              <!-- Campos restantes de usuario -->
              {% for field in f_usuario %}
              {% if field.name != "foto" %}
              <div class="mb-3">
                <label class="form-label">{{ field.label }}</label>
                {{ field }}
                {% for e in field.errors %}
                <div class="text-danger small">{{ e }}</div>
                {% endfor %}
              </div>
              {% endif %}
              {% endfor %}

              <div class="admincfg__actions">
                <button type="submit" name="guardar_usuario" class="btn btn-secondary admincfg__btn">
                  <i class="fa-regular fa-floppy-disk" aria-hidden="true"></i>
                  Guardar Perfil
                </button>
              </div>
            </form>
          </div>
        </section>
      </div>
    </div>

  </div>
</div>
{% endblock %}