{% extends "base_app.html" %}
{% load static %}
{% block title %}Configuración de Administrador{% endblock %}

{% block content %}
<div class="container py-4">
  <h2 class="mb-3">Configuración de Administrador</h2>
  <p class="text-muted mb-4">Empresa activa: <strong>{{ empresa.razon_social }}</strong> ({{ empresa.rut }})</p>

  <div class="row g-4">

    <!-- Empresa -->
    <div class="col-12 col-lg-6">
      <div class="card shadow-sm">
        <div class="card-header"><h5 class="mb-0">Datos de la Empresa</h5></div>
        <div class="card-body">
          <form method="post" enctype="multipart/form-data">  <!-- enctype -->
            {% csrf_token %}
            {{ f_empresa.non_field_errors }}

            <!-- Logo -->
            <div class="mb-3">
              <label class="form-label">Logo</label>
              {% if empresa.logo %}
                <div class="mb-2">
                  <img src="{{ empresa.logo.url }}" alt="Logo" style="max-height:80px; border-radius:8px;">
                </div>
              {% endif %}
              {{ f_empresa.logo }}
              <div class="form-text">Formatos: JPG/PNG. Tamaño recomendado ≤ 1MB.</div>
            </div>

            {% for field in f_empresa %}
              {% if field.name != "logo" %}
              <div class="mb-3">
                <label class="form-label">{{ field.label }}</label>
                {{ field }}
                {% if field.help_text %}<div class="form-text">{{ field.help_text }}</div>{% endif %}
                {% for e in field.errors %}<div class="text-danger small">{{ e }}</div>{% endfor %}
              </div>
              {% endif %}
            {% endfor %}
            <button type="submit" name="guardar_empresa" class="btn btn-primary w-100">Guardar Empresa</button>
          </form>
        </div>
      </div>
    </div>

    <!-- Usuario -->
    <div class="col-12 col-lg-6">
      <div class="card shadow-sm">
        <div class="card-header"><h5 class="mb-0">Perfil del Administrador</h5></div>
        <div class="card-body">
          <form method="post" enctype="multipart/form-data"> <!-- enctype -->
            {% csrf_token %}
            {{ f_usuario.non_field_errors }}

            <!-- Foto -->
            <div class="mb-3">
              <label class="form-label">Foto de perfil</label>
              {% if request.user.foto %}
                <div class="mb-2">
                  <img src="{{ request.user.foto.url }}" alt="Avatar" style="max-height:80px; border-radius:50%;">
                </div>
              {% endif %}
              {{ f_usuario.foto }}
              <div class="form-text">Formatos: JPG/PNG. Tamaño recomendado ≤ 1MB.</div>
            </div>

            {% for field in f_usuario %}
              {% if field.name != "foto" %}
              <div class="mb-3">
                <label class="form-label">{{ field.label }}</label>
                {{ field }}
                {% for e in field.errors %}<div class="text-danger small">{{ e }}</div>{% endfor %}
              </div>
              {% endif %}
            {% endfor %}
            <button type="submit" name="guardar_usuario" class="btn btn-secondary w-100">Guardar Perfil</button>
          </form>
        </div>
      </div>
    </div>

  </div>
</div>
{% endblock %}
