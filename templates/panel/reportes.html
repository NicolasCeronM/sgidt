{% extends 'base_app.html' %}
{% load static %}
{% block title %}Reportes · SGIDT{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'reportes/css/reportes.css' %}?v=1">

<section class="rp-page">
  <div class="rp-container">
    <!-- Encabezado -->
    <header class="rp-head">
      <div>
        <h1 class="rp-title">Reportes</h1>
        <p class="rp-subtitle">Visualiza y exporta tus indicadores tributarios por período.</p>
      </div>

      <!-- Controles superiores -->
      <div class="rp-controls">
        <label for="reportPeriod" class="rp-label">Período</label>
        <select id="reportPeriod" class="rp-select">
          <option value="monthly" selected>Mensual</option>
          <option value="quarterly">Trimestral</option>
          <option value="yearly">Anual</option>
        </select>

        <button class="btn btn-ghost" onclick="exportReport('csv', event)">
          <i class="fas fa-file-csv"></i> CSV
        </button>
        <button class="btn btn-ghost" onclick="exportReport('excel', event)">
          <i class="fas fa-file-excel"></i> Excel
        </button>
      </div>
    </header>

    <!-- Resumen + Detalle -->
    <div class="rp-grid">
      <!-- Resumen -->
      <section class="card">
        <h3 class="card-title">Resumen Financiero</h3>

        <div class="rp-summary">
          <div class="sum-item">
            <span class="sum-label">Ingresos Totales</span>
            <span class="sum-value positive" id="summaryIncome">$45.678.900</span>
          </div>
          <div class="sum-item">
            <span class="sum-label">Gastos Totales</span>
            <span class="sum-value negative" id="summaryExpenses">$32.456.780</span>
          </div>
          <div class="sum-item">
            <span class="sum-label">IVA Débito</span>
            <span class="sum-value" id="summaryIvaDebit">$8.678.991</span>
          </div>
          <div class="sum-item">
            <span class="sum-label">IVA Crédito</span>
            <span class="sum-value" id="summaryIvaCredit">$6.166.787</span>
          </div>
        </div>
      </section>

      <!-- Tabla -->
      <section class="card">
        <h3 class="card-title">Detalle por Período</h3>

        <div class="rp-tablewrap">
          <table class="rp-table">
            <thead>
              <tr>
                <th>Período</th>
                <th>Ingresos</th>
                <th>Gastos</th>
                <th>IVA Débito</th>
                <th>IVA Crédito</th>
                <th>Resultado</th>
              </tr>
            </thead>
            <tbody id="reportTableBody">
              <!-- se llena desde JS -->
            </tbody>
          </table>
        </div>
      </section>
    </div>
  </div>
</section>

<script>
  // Ejemplo de carga mínima si aún no tienes script
  (function () {
    const rows = [
      { p: '2025-01', i: 4567890, g: 3245678, d: 867899, c: 616678, r: 1322212 },
      { p: '2024-12', i: 4211000, g: 2978000, d: 801000, c: 571000, r: 1233000 },
      { p: '2024-11', i: 3980000, g: 2846000, d: 760000, c: 545000, r: 1134000 },
    ];
    const fmt = new Intl.NumberFormat('es-CL');
    const tbody = document.getElementById('reportTableBody');
    if (!tbody || tbody.children.length) return;
    rows.forEach(r => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${r.p}</td>
        <td>$${fmt.format(r.i)}</td>
        <td>$${fmt.format(r.g)}</td>
        <td>$${fmt.format(r.d)}</td>
        <td>$${fmt.format(r.c)}</td>
        <td><span class="badge ${r.r >= 0 ? 'ok' : 'off'}">${r.r >= 0 ? '▲ ' : '▼ '}$${fmt.format(Math.abs(r.r))}</span></td>
      `;
      tbody.appendChild(tr);
    });
  })();
</script>
{% endblock %}