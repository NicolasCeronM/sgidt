{% extends 'base_app.html' %}
{% load static %}
{% block title %}Reportes · SGIDT{% endblock %}

{% block css %}
<link rel="stylesheet" href="{% static 'reportes/css/reportes.css' %}">
{% endblock %}


{% block content %}
<div class="rp-container">
    <header class="rp-header">
        <div class="rp-header-content">
            <h1 class="rp-title">Reportes Mensuales</h1>
            <p class="rp-subtitle">Visualización detallada y exportación de indicadores tributarios clave</p>
        </div>
        <div class="rp-filters">
            <div class="rp-filter-group">
                <select id="monthSelector" class="rp-select">
                    <option>Seleccionar mes</option>
                </select>
                <select id="yearSelector" class="rp-select">
                    <option>Seleccionar año</option>
                </select>
            </div>
            <div class="rp-actions">
                <button id="exportCsvBtn" class="rp-btn btn-secondary">
                    <i class="fas fa-file-csv"></i>
                    <span>CSV</span>
                </button>
                <button id="exportExcelBtn" class="rp-btn btn-primary">
                    <i class="fas fa-file-excel"></i>
                    <span>Excel</span>
                </button>
            </div>
        </div>
    </header>

    <section class="rp-kpi-grid">
        <div class="rp-kpi-card kpi-ingresos">
            <div class="kpi-icon">
                <i class="fas fa-arrow-trend-up"></i>
            </div>
            <div class="kpi-content">
                <h4>Total Ingresos</h4>
                <p id="kpiIngresos">$0</p>
                <span class="kpi-badge positive">+0%</span>
            </div>
        </div>
        <div class="rp-kpi-card kpi-gastos">
            <div class="kpi-icon">
                <i class="fas fa-arrow-trend-down"></i>
            </div>
            <div class="kpi-content">
                <h4>Total Gastos</h4>
                <p id="kpiGastos">$0</p>
                <span class="kpi-badge negative">+0%</span>
            </div>
        </div>
        <div class="rp-kpi-card kpi-resultado">
            <div class="kpi-icon">
                <i class="fas fa-chart-line"></i>
            </div>
            <div class="kpi-content">
                <h4>Resultado Neto</h4>
                <p id="kpiResultado">$0</p>
                <span class="kpi-badge neutral">0%</span>
            </div>
        </div>
    </section>

    <section class="rp-charts-grid">
        <div class="rp-chart-card">
            <div class="chart-header">
                <h5>Ingresos vs. Gastos</h5>
                <span class="chart-period">Periodo actual</span>
            </div>
            <div id="ingresosVsGastosChart" class="chart-container"></div>
        </div>
        <div class="rp-chart-card">
            <div class="chart-header">
                <h5>Análisis de IVA</h5>
                <span class="chart-period">Crédito y Débito</span>
            </div>
            <div id="analisisIvaChart" class="chart-container"></div>
        </div>
        <div class="rp-chart-card">
            <div class="chart-header">
                <h5>Distribución de Ingresos</h5>
                <span class="chart-period">Por tipo de documento</span>
            </div>
            <div id="distribucionIngresosChart" class="chart-container"></div>
        </div>
        <div class="rp-chart-card">
            <div class="chart-header">
                <h5>Distribución de Gastos</h5>
                <span class="chart-period">Por proveedor</span>
            </div>
            <div id="distribucionGastosChart" class="chart-container"></div>
        </div>
    </section>

    <section class="rp-table-card">
        <div class="table-header">
            <h5>Detalle de Documentos Recientes</h5>
            <div class="table-actions">
                <button class="table-filter-btn">
                    <i class="fas fa-filter"></i>
                    Filtrar
                </button>
            </div>
        </div>
        <div class="table-responsive">
            <table class="table">
                <thead>
                    <tr>
                        <th>Folio</th>
                        <th>Tipo de Documento</th>
                        <th>Fecha de Emisión</th> 
                        <th>Monto Total</th>
                    </tr>
                </thead>
                <tbody id="reportTableBody">
                    <tr>
                        <td colspan="4" class="table-loading">
                            <div class="loading-spinner"></div>
                            <span>Cargando datos del periodo...</span>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </section>

</div>
{% endblock %}


{% block js %}
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
<script src="{% static 'reportes/js/reportes.js' %}"></script>
{% endblock %}
