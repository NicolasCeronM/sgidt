{% extends 'base_app.html' %} {% load static %} {% block title %}Documentos ·
SGIDT{% endblock %} {% block content %} {% block css %}
<link
  rel="stylesheet"
  href="{% static 'documentos/css/documentos.css' %}?v=3"
/>
{% endblock %}

<!-- Línea de carga superior -->
<div id="pageProgress" class="page-progress" aria-hidden="true"></div>

<!-- Contenedor para notificaciones -->
<div id="toastContainer" class="toast-container"></div>

<section class="docs-page" aria-labelledby="docs-title">
  <div class="docs-container">
    <h1 id="docs-title" class="docs-title">Gestión de Documentos</h1>

    <!-- SUBIDA / DROPZONE -->
    <section class="card upload-card" aria-labelledby="up-title">
      <h2 id="up-title" class="card-title">Subir Nuevo Documento</h2>

      <div
        id="uploadArea"
        class="upload-area"
        role="group"
        tabindex="0"
        aria-describedby="drop-hint"
      >
        <i class="fas fa-cloud-upload-alt" aria-hidden="true"></i>
        <p class="dz-title">
          Arrastra archivos aquí o haz clic para seleccionar
        </p>
        <p id="drop-hint" class="upload-hint">
          PDF, JPG, PNG (máx. 10MB por archivo)
        </p>
      </div>

      <!-- form invisible para CSRF + file input -->
      <form
        id="uploadForm"
        method="post"
        enctype="multipart/form-data"
        style="display: none"
      >
        {% csrf_token %}
        <input
          type="file"
          id="fileInput"
          name="files[]"
          accept=".pdf,.jpg,.jpeg,.png"
          multiple
        />
      </form>

      <div class="upload-actions">
        <button class="btn btn-primary" id="btnSelect">
          <i class="fas fa-plus"></i> Seleccionar archivos
        </button>
        <a href="{% url 'panel:documentos_page' %}" class="btn btn-ghost">
          <i class="fas fa-folder-open"></i> Ver documentos
        </a>
      </div>

      <!-- Cola de subida -->
      <ul id="queue" class="upload-queue" hidden></ul>
    </section>

    <!-- FILTROS -->
    <section
      class="card filters"
      role="search"
      aria-label="Filtros de documentos"
    >
      <form id="filter-form" class="filters-grid">
        <div class="f-item">
          <label for="dateFrom">Fecha desde</label>
          <div class="f-input">
            <i class="far fa-calendar-alt" aria-hidden="true"></i>
            <input type="date" id="dateFrom" />
          </div>
        </div>

        <div class="f-item">
          <label for="dateTo">Fecha hasta</label>
          <div class="f-input">
            <i class="far fa-calendar-alt" aria-hidden="true"></i>
            <input type="date" id="dateTo" />
          </div>
        </div>

        <div class="f-item">
          <label for="docType">Tipo</label>
          <div class="f-input">
            <i class="fas fa-file-invoice" aria-hidden="true"></i>
            <select id="docType">
              <option value="">Todos</option>
              <option value="factura">Factura</option>
              <option value="boleta">Boleta</option>
              <option value="nc">Nota de crédito</option>
            </select>
          </div>
        </div>

        <div class="f-item">
          <label for="docStatus">Estado</label>
          <div class="f-input">
            <i class="fas fa-circle-notch" aria-hidden="true"></i>
            <select id="docStatus">
              <option value="">Todos</option>
              <option value="procesado">Procesado</option>
              <option value="cola">En cola</option>
              <option value="error">Error</option>
            </select>
          </div>
        </div>

        <div class="f-actions">
          <button type="button" class="btn btn-primary" id="btnFilter">
            <i class="fas fa-filter"></i> Filtrar
          </button>
          <button type="reset" class="btn btn-ghost" id="btn-clear">
            Limpiar
          </button>
        </div>
      </form>
      <div id="result-info" class="result-info" aria-live="polite"></div>
    </section>

    <!-- TABLA -->
    <section class="card table-card" aria-labelledby="tbl-title">
      <h2 id="tbl-title" class="sr-only">Listado de documentos</h2>

      <!-- Skeleton -->
      <div class="table-skeleton" id="tbl-skeleton">
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
      </div>

      <div class="table-wrap" aria-busy="false">
        <table class="table">
          <thead>
            <tr>
              <th>Fecha</th>
              <th>Tipo</th>
              <th>Folio</th>
              <th>RUT Emisor</th>
              <th>Razón Social</th>
              <!-- <th class="num">Neto</th>
              <th class="num">Exento</th>
              <th class="num">IVA</th> -->
              <th class="num">Total</th>
              <th>Estado</th>
              <th>Validación SII</th>
              <th class="actions">Acciones</th>
            </tr>
          </thead>
          <tbody id="documentsTableBody"></tbody>
        </table>
      </div>

      <!-- Empty -->

      <div id="tbl-empty" class="empty-state" hidden>
        <p class="empty-text">Aún no hay documentos.</p>
      </div>

    </section>
  </div>
</section>
<!-- progreso en tiempo real (IIFE no-module) -->
<script src="{% static 'documentos/js/progreso.js' %}?v=2"></script>
<!-- módulo principal -->
<script type="module" src="{% static 'documentos/js/main.js' %}?v=1"></script>

{% endblock %}
