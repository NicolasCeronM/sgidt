{% extends 'base_app.html' %}
{% load static %}
{% block title %}Ayuda · SGIDT{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'ayuda/css/ayuda.css' %}?v=12">

<section class="section">
  <div class="container">
    <h1 class="page-title">Ayuda y Soporte</h1>
    <p class="muted max-w-760">
      Encuentra respuestas rápidas, guías prácticas y soporte directo para <strong>SGIDT</strong>.
    </p>

    <!-- Tarjetas de ayuda -->
    <div class="help-grid">
      <div class="help-card">
        <i class="fas fa-question-circle help-icon"></i>
        <h3>Preguntas Frecuentes</h3>
        <p>Respuestas a las dudas más comunes sobre el uso de SGIDT.</p>
        <a href="{% url 'panel:faq' %}" class="btn btn-secondary">
          <i class="fas fa-book-open"></i> Ver preguntas frecuentes
        </a>
      </div>

      <div class="help-card">
        <i class="fas fa-book help-icon"></i>
        <h3>Manual de Usuario</h3>
        <p>Guía completa con ejemplos para aprovechar todas las funciones.</p>
        <a href="{% url 'panel:manual_pdf' %}" download class="btn btn-secondary">
          <i class="fas fa-file-download"></i> Descargar Manual (PDF)
        </a>
      </div>

      <!-- Soporte Técnico -->
      <div class="help-card" id="cardSoporte">
        <i class="fas fa-headset help-icon"></i>
        <h3>Soporte Técnico</h3>
        <p>¿Problemas técnicos? Nuestro equipo está para ayudarte.</p>

        <a href="#support-panel" id="btnContactarSoporte" class="btn btn-secondary" aria-expanded="false" aria-controls="support-panel">
          <i class="fas fa-comments"></i> Contactar Soporte
        </a>

        <!-- Panel colapsable con el formulario -->
        <div id="support-panel" class="support-panel" hidden>
          <hr class="support-sep">

          <form id="helpContactForm" action="{% url 'panel:ayuda_contacto' %}" method="post" class="support-form">
            {% csrf_token %}
            <input type="text" name="hp" style="display:none" tabindex="-1" autocomplete="off">

            <div class="form-grid">
              <div class="form-group">
                <label for="helpName">Nombre</label>
                <input type="text" id="helpName" name="name" class="form-input" placeholder="Tu nombre" required>
              </div>
              <div class="form-group">
                <label for="helpEmail">Email</label>
                <input type="email" id="helpEmail" name="email" class="form-input" placeholder="tu@correo.cl" required>
              </div>
              <div class="form-group" style="grid-column: 1 / -1">
                <label for="helpMessage">Mensaje</label>
                <textarea id="helpMessage" name="message" class="form-input" rows="4"
                  placeholder="Cuéntanos tu duda o problema" required></textarea>
              </div>
            </div>

            <button class="btn btn-primary" type="submit">
              <i class="fas fa-paper-plane"></i> Enviar Mensaje
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>
</section>

<script src="{% static 'ayuda/js/ayuda_contacto.js' %}?v=3"></script>

<!-- Toggle del panel de soporte -->
<script>
  (function () {
    const btn   = document.getElementById('btnContactarSoporte');
    const panel = document.getElementById('support-panel');
    const name  = document.getElementById('helpName');

    if (!btn || !panel) return;

    btn.addEventListener('click', (e) => {
      e.preventDefault();
      const open = panel.hasAttribute('hidden') ? false : true;
      if (open) {
        panel.setAttribute('hidden', '');
        btn.setAttribute('aria-expanded', 'false');
      } else {
        panel.removeAttribute('hidden');
        btn.setAttribute('aria-expanded', 'true');
        // foco y scroll suave
        requestAnimationFrame(() => {
          name?.focus();
          panel.scrollIntoView({ behavior: 'smooth', block: 'start' });
        });
      }
    });
  })();
</script>
{% endblock %}
