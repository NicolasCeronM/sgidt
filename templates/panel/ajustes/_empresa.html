{% load static %}
<div class="settings-section row">
  <div class="col-md-4 settings-section-info">
    <h4>Perfil de la Empresa</h4>
    <p>Esta información se utiliza en documentos (como facturas), validaciones y notificaciones.</p>
  </div>
  <div class="col-md-8 settings-section-content">
    <div class="card">
      <form method="post" class="settings-form" action="{% url 'panel:ajustes_empresa' %}" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="card-body p-4">
        
          <!-- Logo de la empresa -->
          <div class="settings-row">
            <div class="settings-label">Logo de la Empresa</div>
            <div class="settings-field">
              <div class="logo-upload">
                {% if empresa and empresa.logo %}
                  <img src="{{ empresa.logo.url }}" alt="Logo de {{ empresa.razon_social }}" class="logo-preview">
                {% else %}
                  <img src="{% static 'panel/img/logo_default.png' %}" alt="Logo" class="logo-preview">
                {% endif %}
                <div class="avatar-actions">
                  <label for="logo-input" class="btn btn-sm btn-outline-primary">Subir logo</label>
                  <button type="button" class="btn btn-sm btn-outline-secondary" id="logo-remove-btn">Quitar</button>
                  <input type="file" id="logo-input" name="company_logo" class="d-none" accept="image/png, image/jpeg">
                  <input type="hidden" name="remove_logo" id="remove-logo-input" value="0">
                  <div class="settings-help">Se usará en facturas y correos.</div>
                </div>
              </div>
            </div>
          </div>

          <!-- RUT -->
          <div class="settings-row">
            <div class="settings-label">RUT</div>
            <div class="settings-field">
              <input class="form-control" type="text" name="company_rut"
                     value="{{ empresa.rut|default_if_none:'' }}" placeholder="76.123.456-7">
            </div>
          </div>

          <!-- Razón Social -->
          <div class="settings-row">
            <div class="settings-label">Razón Social</div>
            <div class="settings-field">
              <input class="form-control" type="text" name="company_name"
                     value="{{ empresa.razon_social|default_if_none:'' }}" placeholder="Empresa de prueba">
            </div>
          </div>

          <!-- Email -->
          <div class="settings-row">
            <div class="settings-label">Email de Contacto</div>
            <div class="settings-field">
              <input class="form-control" type="email" name="company_email"
                     value="{{ empresa.email|default_if_none:'' }}" placeholder="contacto@empresa.cl">
            </div>
          </div>

          <!-- Teléfono -->
          <div class="settings-row">
            <div class="settings-label">Teléfono</div>
            <div class="settings-field">
              <input class="form-control" type="text" name="company_phone"
                     value="{{ empresa.telefono|default_if_none:'' }}" placeholder="+56 9 1234 5678">
            </div>
          </div>

          <!-- Dirección -->
          <div class="settings-row">
            <div class="settings-label">Dirección</div>
            <div class="settings-field">
              <input class="form-control mb-2" type="text" name="company_address_1"
              value="{{ empresa.direccion|default_if_none:'' }}" placeholder="Calle Falsa 123, Oficina 45">
              <input class="form-control mb-2" type="text" name="company_city"
              value="{{ empresa.comuna|default_if_none:'' }}" placeholder="Ciudad">
              <input class="form-control" type="text" name="company_country"
               value="{{ empresa.region|default_if_none:'' }}" placeholder="Chile">
            </div>
          </div>

        </div>
        <div class="card-footer settings-actions">
          <button class="btn btn-primary" type="submit" name="action_update_company">Guardar Empresa</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const logoInput = document.getElementById("logo-input");
    const logoPreview = document.querySelector(".logo-preview");
    const removeBtn = document.getElementById("logo-remove-btn");
    const removeInput = document.getElementById("remove-logo-input");
    const defaultLogoSrc = "{% static 'panel/img/logo_default.png' %}";

    // Previsualizar logo nuevo
    if (logoInput) {
      logoInput.addEventListener("change", function (e) {
        const [file] = e.target.files;
        if (file) {
          logoPreview.src = URL.createObjectURL(file);
          removeInput.value = "0";  
        }
      });
    }

    // Quitar logo (frontend + marcar para backend)
    if (removeBtn) {
      removeBtn.addEventListener("click", function () {
        logoPreview.src = defaultLogoSrc;
        logoInput.value = "";
        removeInput.value = "1";   
      });
    }
  });
</script>